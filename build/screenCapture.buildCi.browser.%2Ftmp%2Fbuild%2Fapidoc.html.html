<html><head></head><body><div class="apidocDiv">
<style>
/*csslint
*/
.apidocDiv {
    background: #fff;
    font-family: Arial, Helvetica, sans-serif;
}
.apidocDiv a[href] {
    color: #33f;
    font-weight: bold;
    text-decoration: none;
}
.apidocDiv a[href]:hover {
    text-decoration: underline;
}
.apidocCodeCommentSpan {
    background: #bbf;
    color: #000;
    display: block;
}
.apidocCodeKeywordSpan {
    color: #d00;
    font-weight: bold;
}
.apidocCodePre {
    background: #eef;
    border: 1px solid;
    color: #777;
    padding: 5px;
    white-space: pre-wrap;
}
.apidocFooterDiv {
    margin-top: 20px;
    text-align: center;
}
.apidocModuleLi {
    margin-top: 10px;
}
.apidocSectionDiv {
    border-top: 1px solid;
    margin-top: 20px;
}
.apidocSignatureSpan {
    color: #777;
    font-weight: bold;
}
</style>
<h1>api documentation for
    <a href="https://github.com/axemclion/perfjankie#readme">perfjankie (v2.1.2)</a>
</h1>
<h4>Browser Performance regression suite</h4>
<div class="apidocSectionDiv"><a href="#apidoc.tableOfContents" id="apidoc.tableOfContents"><h1>table of contents</h1></a><ol>

    <li class="apidocModuleLi"><a href="#apidoc.module.perfjankie">module perfjankie</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.perfjankie.perfjankie">
            function <span class="apidocSignatureSpan"></span>perfjankie
            <span class="apidocSignatureSpan">(config)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.perfjankie.couchData">
            function <span class="apidocSignatureSpan">perfjankie.</span>couchData
            <span class="apidocSignatureSpan">(config, data)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.perfjankie.couchSite">
            function <span class="apidocSignatureSpan">perfjankie.</span>couchSite
            <span class="apidocSignatureSpan">(config)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.perfjankie.couchViews">
            function <span class="apidocSignatureSpan">perfjankie.</span>couchViews
            <span class="apidocSignatureSpan">(config)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.perfjankie.init">
            function <span class="apidocSignatureSpan">perfjankie.</span>init
            <span class="apidocSignatureSpan">(config)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.perfjankie.metricsgen">
            function <span class="apidocSignatureSpan">perfjankie.</span>metricsgen
            <span class="apidocSignatureSpan">(grunt)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.perfjankie.migrate_0_2_0">
            function <span class="apidocSignatureSpan">perfjankie.</span>migrate_0_2_0
            <span class="apidocSignatureSpan">(oldDb, newDb, config)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.perfjankie.migrate_0_3_0">
            function <span class="apidocSignatureSpan">perfjankie.</span>migrate_0_3_0
            <span class="apidocSignatureSpan">(oldDb, newDb, config)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.perfjankie.migrate_0_4_0">
            function <span class="apidocSignatureSpan">perfjankie.</span>migrate_0_4_0
            <span class="apidocSignatureSpan">(oldDb, newDb, config)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.perfjankie.options">
            function <span class="apidocSignatureSpan">perfjankie.</span>options
            <span class="apidocSignatureSpan">(config)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.perfjankie.perfTests">
            function <span class="apidocSignatureSpan">perfjankie.</span>perfTests
            <span class="apidocSignatureSpan">(config)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.perfjankie.task">
            function <span class="apidocSignatureSpan">perfjankie.</span>task
            <span class="apidocSignatureSpan">(grunt)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.perfjankie.toString">
            function <span class="apidocSignatureSpan">perfjankie.</span>toString
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">perfjankie.</span>utility</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">perfjankie.</span>utils</span>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.perfjankie.couchData">module perfjankie.couchData</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.perfjankie.couchData.couchData">
            function <span class="apidocSignatureSpan">perfjankie.</span>couchData
            <span class="apidocSignatureSpan">(config, data)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.perfjankie.couchSite">module perfjankie.couchSite</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.perfjankie.couchSite.couchSite">
            function <span class="apidocSignatureSpan">perfjankie.</span>couchSite
            <span class="apidocSignatureSpan">(config)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.perfjankie.couchViews">module perfjankie.couchViews</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.perfjankie.couchViews.couchViews">
            function <span class="apidocSignatureSpan">perfjankie.</span>couchViews
            <span class="apidocSignatureSpan">(config)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.perfjankie.init">module perfjankie.init</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.perfjankie.init.init">
            function <span class="apidocSignatureSpan">perfjankie.</span>init
            <span class="apidocSignatureSpan">(config)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.perfjankie.metricsgen">module perfjankie.metricsgen</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.perfjankie.metricsgen.metricsgen">
            function <span class="apidocSignatureSpan">perfjankie.</span>metricsgen
            <span class="apidocSignatureSpan">(grunt)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.perfjankie.migrate_0_2_0">module perfjankie.migrate_0_2_0</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.perfjankie.migrate_0_2_0.migrate_0_2_0">
            function <span class="apidocSignatureSpan">perfjankie.</span>migrate_0_2_0
            <span class="apidocSignatureSpan">(oldDb, newDb, config)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.perfjankie.migrate_0_3_0">module perfjankie.migrate_0_3_0</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.perfjankie.migrate_0_3_0.migrate_0_3_0">
            function <span class="apidocSignatureSpan">perfjankie.</span>migrate_0_3_0
            <span class="apidocSignatureSpan">(oldDb, newDb, config)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.perfjankie.migrate_0_4_0">module perfjankie.migrate_0_4_0</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.perfjankie.migrate_0_4_0.migrate_0_4_0">
            function <span class="apidocSignatureSpan">perfjankie.</span>migrate_0_4_0
            <span class="apidocSignatureSpan">(oldDb, newDb, config)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.perfjankie.options">module perfjankie.options</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.perfjankie.options.options">
            function <span class="apidocSignatureSpan">perfjankie.</span>options
            <span class="apidocSignatureSpan">(config)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.perfjankie.perfTests">module perfjankie.perfTests</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.perfjankie.perfTests.perfTests">
            function <span class="apidocSignatureSpan">perfjankie.</span>perfTests
            <span class="apidocSignatureSpan">(config)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.perfjankie.task">module perfjankie.task</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.perfjankie.task.task">
            function <span class="apidocSignatureSpan">perfjankie.</span>task
            <span class="apidocSignatureSpan">(grunt)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.perfjankie.toString">module perfjankie.toString</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.perfjankie.toString.toString">
            function <span class="apidocSignatureSpan">perfjankie.</span>toString
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.perfjankie.utility">module perfjankie.utility</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.perfjankie.utility.forEachDoc">
            function <span class="apidocSignatureSpan">perfjankie.utility.</span>forEachDoc
            <span class="apidocSignatureSpan">(oldDb, newDb, callback)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.perfjankie.utils">module perfjankie.utils</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.perfjankie.utils.getCouchDB">
            function <span class="apidocSignatureSpan">perfjankie.utils.</span>getCouchDB
            <span class="apidocSignatureSpan">(options)</span>
            </a>

        </li>

    </ol></li>

</ol></div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.perfjankie" id="apidoc.module.perfjankie">module perfjankie</a></h1>


    <h2>
        <a href="#apidoc.element.perfjankie.perfjankie" id="apidoc.element.perfjankie.perfjankie">
        function <span class="apidocSignatureSpan"></span>perfjankie
        <span class="apidocSignatureSpan">(config)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">perfjankie = function (config) {
	var options = require('./options')(config),
		log = options.log,
		cb = options.callback;

	log.info('Starting PerfJankie');

	init(config).then(function() {
		return runTests(config);
	}).then(function() {
		return Q.allSettled([site(config), views(config)]);
	}).then(function(res) {
		log.debug('Successfully done all tasks');
		cb(null, res);
	}, function(err) {
		log.debug(err);
		cb(err, null);
	}).done();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.perfjankie.couchData" id="apidoc.element.perfjankie.couchData">
        function <span class="apidocSignatureSpan">perfjankie.</span>couchData
        <span class="apidocSignatureSpan">(config, data)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">couchData = function (config, data) {
    var server = require('./utils').getCouchDB(config.couch),
        Q = require('q'),
        dfd = Q.defer();

    var db = null,
        log = config.log;

    db = server.use(config.couch.database);
    log.debug('Saving data');

    if (typeof data === 'undefined') {
        return;
    }

    db.bulk({
        docs: data.map(function (val) {
            var res = {
                url: config.url,
                data: val,
                meta: {},
                name: config.name,
                suite: config.suite,
                browser: val._browser || val._browserName,
                run: config.run || config.time,
                time: config.time,
                type: 'perfData'
            };
            for (var key in res.data) {
                if (key.indexOf('_') === 0) {
                    res.meta[key] = res.data[key];
                    delete res.data[key];
                }
            }
            return res;
        })
    }, {
        new_edits: true
    }, function (err, res) {
        log.debug('Got result back after saving data');
        err ? dfd.reject(err) : dfd.resolve(res);
    });

    return dfd.promise;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.perfjankie.couchSite" id="apidoc.element.perfjankie.couchSite">
        function <span class="apidocSignatureSpan">perfjankie.</span>couchSite
        <span class="apidocSignatureSpan">(config)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">couchSite = function (config) {

    var Q = require('q');

    if (!config.couch.updateSite) {
        return Q(1); // jshint ignore:line
    }

    var path = require('path'),
        log = config.log;

    var siteDest = path.join(__dirname, '../bin-site'),
        server = require('./utils').getCouchDB(config.couch),
        db = server.use(config.couch.database);

    var mime = require('./mime');

    function contentType(filename) {
        var contentType = path.extname(filename);
        if (contentType.length &gt; 0) {
            return mime[contentType.substring(1)];
        } else {
            return 'text';
        }
    }

    function readFileContents(files, siteDest) {
        var fs = require('fs'),
            path = require('path');

        var dfd = Q.defer();
        var fileContents = [];

        (function readFile(i) {
            if (i &lt; files.length) {
                fs.readFile(path.join(siteDest, files[i]), function (err, data) {
                    if (!err) {
                        fileContents.push({
                            name: files[i],
                            data: data,
                            contentType: contentType(files[i]),
                            content_type: contentType(files[i])
                        });
                    }
                    readFile(i + 1);
                });
            } else {
                log.debug('Completed reading all files');
                dfd.resolve(fileContents);
            }
        }(0));

        return dfd.promise;
    }

    function removeSite() {
        var dfd = Q.defer();
        db.get('_design/site', function (err, res) {
            if (!err) {
                db.destroy('_design/site', res._rev, function (err, res) {
                    if (err) {
                        dfd.reject(err);
                    } else {
                        dfd.resolve();
                    }
                });
            } else {
                dfd.resolve();
            }
        });
        return dfd.promise;
    }

    return removeSite().then(function () {
        return Q.nfcall(require('glob'), '**/*.*', {
            cwd: siteDest
        });
    }).then(function (files) {
        return readFileContents(files, siteDest);
    }).then(function (fileContents) {
        return Q.ninvoke(db.multipart, 'insert', {}, fileContents, '_design/site');
    }).then(function () {
        var link = url.parse([config.couch.server, config.couch.database, '_design/site/index.html'].join('/'));
        link.auth = null;
        log.info('Site Updated. View graphs at ' + url.format(link));
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.perfjankie.couchViews" id="apidoc.element.perfjankie.couchViews">
        function <span class="apidocSignatureSpan">perfjankie.</span>couchViews
        <span class="apidocSignatureSpan">(config)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">couchViews = function (config) {
    if (!config.couch.updateSite) {
        return Q(); // jshint ignore:line
    }

    var log = config.log,
        server = require('./utils').getCouchDB(config.couch),
        db = server.use(config.couch.database);

    return uploadViews(db, log);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.perfjankie.init" id="apidoc.element.perfjankie.init">
        function <span class="apidocSignatureSpan">perfjankie.</span>init
        <span class="apidocSignatureSpan">(config)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">init = function (config) {
    var Q = require('q'),
        server = require('./utils').getCouchDB(config.couch),
        log = config.log;

    log.debug('Trying to see if the database exists');

    return Q.ninvoke(server.db, 'get', config.couch.database).catch(function (err) {
        log.debug('Could not find database: %s\nCreating a new database %s', err.reason, config.couch.database);
        return Q.ninvoke(server.db, 'create', config.couch.database);
    }).then(function () {
        var db = server.use(config.couch.database);
        return Q.ninvoke(db, 'get', 'version').catch(function (err) {
            return Q.ninvoke(db, 'insert', {
                version: require('../package.json').dbVersion
            }, 'version');
        });
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.perfjankie.metricsgen" id="apidoc.element.perfjankie.metricsgen">
        function <span class="apidocSignatureSpan">perfjankie.</span>metricsgen
        <span class="apidocSignatureSpan">(grunt)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">metricsgen = function (grunt) {
	grunt.registerMultiTask('metricsgen', 'Generates the names of metrics', function() {
		var apiDocs = new browserPerf.docs();
		var regex = /(_avg|_max|_count)$/;
		var doc = {};

		for (var key in apiDocs.metrics) {
			var modifier = null;
			if (apiDocs.metrics[key].source === 'TimelineMetrics' &amp;&amp; key.match(regex)) {
				var idx = key.lastIndexOf('_');
				modifier = key.substr(idx + 1);
				key = key.substr(0, idx);
			}
			if (typeof doc[key] === 'undefined') {
				doc[key] = apiDocs.metrics[key] || {};
				doc[key].stats = [];
			}
			if (modifier) {
				doc[key].stats.push(modifier);
			}
		}

		var metrics = [];
		for (var key in doc) {
			doc[key].name = key;
			metrics.push(doc[key]);
		}

		this.files.forEach(function(file) {
			grunt.file.write(file.dest, ['var METRICS_LIST =', JSON.stringify(metrics)].join(''));
		});
	});
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.perfjankie.migrate_0_2_0" id="apidoc.element.perfjankie.migrate_0_2_0">
        function <span class="apidocSignatureSpan">perfjankie.</span>migrate_0_2_0
        <span class="apidocSignatureSpan">(oldDb, newDb, config)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">migrate_0_2_0 = function (oldDb, newDb, config) {
	var log = config.log;

	return utility.forEachDoc(oldDb, newDb, function(doc) {
		if (doc.type !== 'perfData') {
			return null;
		}
		delete doc._id;
		delete doc._rev;
		doc.url = null;
		doc.browser = doc.meta._browserName || null;

		for (var key in doc.data) {
			doc.data[key] = doc.data[key].value;
		}

		doc.data[events[0]] = 0;
		for (var i = 1; i &lt; events.length; i++) {
			if (typeof doc.data[events[i]] === 'undefined') {
				doc.data[events[i]] = 0;
			}
			doc.data[events[i]] = doc.data[events[i]] + doc.data[events[i - 1]];
		}

		return doc;
	});
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.perfjankie.migrate_0_3_0" id="apidoc.element.perfjankie.migrate_0_3_0">
        function <span class="apidocSignatureSpan">perfjankie.</span>migrate_0_3_0
        <span class="apidocSignatureSpan">(oldDb, newDb, config)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">migrate_0_3_0 = function (oldDb, newDb, config) {
	var log = config.log;

	return utility.forEachDoc(oldDb, newDb, function(doc) {
		if (doc.type !== 'perfData') {
			return null;
		}
		delete doc._id;
		delete doc._rev;

		for (var key in doc.data) {
			if (typeof doc.data.mean_frame_time === 'number') { // From TracingMetrics
				doc.data.frames_per_sec = 1000 / doc.data.mean_frame_time;
			}
			if (typeof doc.data.meanFrameTime === 'number') { // from RAF
				doc.data.framesPerSec_raf = 1000 / doc.data.meanFrameTime;

			}
		}

		return doc;
	});
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.perfjankie.migrate_0_4_0" id="apidoc.element.perfjankie.migrate_0_4_0">
        function <span class="apidocSignatureSpan">perfjankie.</span>migrate_0_4_0
        <span class="apidocSignatureSpan">(oldDb, newDb, config)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">migrate_0_4_0 = function (oldDb, newDb, config) {
	var log = config.log;

	return utility.forEachDoc(oldDb, newDb, function(doc) {
		if (doc.type !== 'perfData') {
			return null;
		}
		delete doc._id;
		delete doc._rev;

		doc.data.meanFrameTime_raf = doc.data.meanFrameTime;

		var metrics = new Metrics(doc.data);

		metrics.addMetric('loadTime', 'loadEventEnd', 'fetchStart');
		metrics.addMetric('domReadyTime', 'domComplete', 'domInteractive');
		metrics.addMetric('readyStart', 'fetchStart', 'navigationStart');
		metrics.addMetric('redirectTime', 'redirectEnd', 'redirectStart');
		metrics.addMetric('appcacheTime', 'domainLookupStart', 'fetchStart');
		metrics.addMetric('unloadEventTime', 'unloadEventEnd', 'unloadEventStart');
		metrics.addMetric('domainLookupTime', 'domainLookupEnd', 'domainLookupStart');
		metrics.addMetric('connectTime', 'connectEnd', 'connectStart');
		metrics.addMetric('requestTime', 'responseEnd', 'requestStart');
		metrics.addMetric('initDomTreeTime', 'domInteractive', 'responseEnd');
		metrics.addMetric('loadEventTime', 'loadEventEnd', 'loadEventStart');

		return doc;
	});
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.perfjankie.options" id="apidoc.element.perfjankie.options">
        function <span class="apidocSignatureSpan">perfjankie.</span>options
        <span class="apidocSignatureSpan">(config)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">options = function (config) {
	var noop = function() {};
	config.log = config.log || config.logger || noop;

	if (typeof config.log === 'function') {
		config.log = {
			'fatal': config.log,
			'error': config.log,
			'warn': config.log,
			'info': config.log,
			'debug': config.log,
			'trace': config.log
		};
	}

	function assert(expr, msg) {
		if (!expr) {
			throw new Error(msg);
		}
	}
	config.selenium = config.selenium || {
		hostname: 'localhost',
		port: 4444
	};
	config.repeat = config.repeat || 1;
	config.name = config.name || config.url;
	config.suite = config.suite || 'Default Test Suite';

	if (typeof config.callback !== 'function') {
		config.callback = noop;
	}

	if (typeof config.couch === 'undefined') {
		config.couch = {};
	}

	if (typeof config.couch.username !== 'undefined') {
		var url = require('url');
		var href = url.parse(config.couch.server);
		href.auth = config.couch.username + ':' + config.couch.pwd;
		config.couch.server = url.format(href);
	}
	assert(typeof config.couch.server !== 'undefined', 'Location to save results is not defined. Please define a couchDB server');

	config.couch.database = config.couch.db || config.couch.database;
	assert(typeof config.couch.server !== 'undefined', 'Location to save results is not defined. Please define a Database to save the
 results');
	return config;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...



module.exports = function(grunt) {
grunt.registerMultiTask('perfjankie', 'Run rendering performance test cases', function() {
  var done = this.async(),
    path = require('path'),
    options = this.<span class="apidocCodeKeywordSpan">options</span>({
      log: { // Expects the following methods,
        fatal: grunt.fail.fatal.bind(grunt.fail),
        error: grunt.fail.warn.bind(grunt.fail),
        warn: grunt.log.error.bind(grunt.log),
        info: grunt.log.ok.bind(grunt.log),
        debug: grunt.verbose.writeln.bind(grunt.verbose),
        trace: grunt.log.debug.bind(grunt.log)
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.perfjankie.perfTests" id="apidoc.element.perfjankie.perfTests">
        function <span class="apidocSignatureSpan">perfjankie.</span>perfTests
        <span class="apidocSignatureSpan">(config)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">perfTests = function (config) {
	var Q = require('q'),
		dfd = Q.defer();

	if (config.couch.onlyUpdateSite) {
		dfd.resolve();
	} else {
		var browserPerf = config.browserPerf || require('browser-perf'),
			log = config.log;

		log.debug('Starting Browser Perf');
		browserPerf(config.url, function(err, results) {
			if (err) {
				dfd.reject(err);
			} else {
				log.debug('Got Browser Perf results back, now saving the results');
				dfd.resolve(results);
			}
		}, {
			browsers: config.browsers,
			selenium: config.selenium,
			debug: config.debug,
			preScript: config.preScript,
			preScriptFile: config.preScriptFile,
			actions: config.actions,
			metrics: config.metrics,
			SAUCE_ACCESSKEY: config.SAUCE_ACCESSKEY || undefined,
			SAUCE_USERNAME: config.SAUCE_USERNAME || undefined,
			BROWSERSTACK_USERNAME: config.BROWSERSTACK_USERNAME || undefined,
			BROWSERSTACK_KEY: config.BROWSERSTACK_KEY || undefined
		});
	}
	return dfd.promise;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.perfjankie.task" id="apidoc.element.perfjankie.task">
        function <span class="apidocSignatureSpan">perfjankie.</span>task
        <span class="apidocSignatureSpan">(grunt)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">task = function (grunt) {
  grunt.registerMultiTask('perfjankie', 'Run rendering performance test cases', function() {
    var done = this.async(),
      path = require('path'),
      options = this.options({
        log: { // Expects the following methods,
          fatal: grunt.fail.fatal.bind(grunt.fail),
          error: grunt.fail.warn.bind(grunt.fail),
          warn: grunt.log.error.bind(grunt.log),
          info: grunt.log.ok.bind(grunt.log),
          debug: grunt.verbose.writeln.bind(grunt.verbose),
          trace: grunt.log.debug.bind(grunt.log)
        },
        time: new Date().getTime()
      }),
      files = options.urls;

    options.time = parseFloat(options.time, 10);
    if (options.sauceTunnel) {
      var SauceTunnel = require('sauce-tunnel');
      grunt.log.writeln('Starting Saucelabs Tunnel');
      var tunnel = new SauceTunnel(options.SAUCE_USERNAME, options.SAUCE_ACCESSKEY, options.sauceTunnel, true);
      tunnel.start(function(status) {
        grunt.log.ok('Saucelabs Tunnel started - ' + status);
        if (status === false) {
          done(false);
        } else {
          runPerfTest(files, options, function(res) {
            grunt.verbose.writeln('All perf tests completed');
            tunnel.stop(function() {
              done(res);
            });
          });
        }
      });
    } else {
      runPerfTest(files, options, done);
    }
  });

  var perfjankie = require('..');

  var runPerfTest = function(files, options, cb) {
    var success = true;
    (function runTest(i) {
      if (i &lt; files.length) {
        grunt.log.writeln('Testing File ', files[i]);
        var config = {
          url: files[i],
          name: files[i].replace(/(\S)*\/|\.html$/gi, ''),
          callback: function(err, res) {
            if (err) {
              success = false;
              console.log(res);
              grunt.log.warn(err);
            } else {
              grunt.log.ok('Saved performance metrics');
            }
            runTest(i + 1);
          }
        };
        for (var key in options) {
          config[key] = options[key];
        }
        perfjankie(config);
      } else {
        cb(success);
      }
    }(0));
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.perfjankie.toString" id="apidoc.element.perfjankie.toString">
        function <span class="apidocSignatureSpan">perfjankie.</span>toString
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">toString = function () {
    return text;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

log.debug('Starting to upload views');
(function uploadView(i) {
    if (i &lt; views.length) {
        log.debug('Checking View ' + views[i]);
        var view = JSON.parse(JSON.stringify(eval('_x_ = ' + fs.readFileSync(views[i], 'utf-8')), function (
key, val) {
            if (typeof val === 'function') {
                return val.<span class="apidocCodeKeywordSpan">toString</span>();
            }
            return val;
        }));
        db.get(view._id, function (err, res) {
            if (!err) {
                view._rev = res._rev;
            }
...</pre></li>
    </ul>






</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.perfjankie.couchData" id="apidoc.module.perfjankie.couchData">module perfjankie.couchData</a></h1>


    <h2>
        <a href="#apidoc.element.perfjankie.couchData.couchData" id="apidoc.element.perfjankie.couchData.couchData">
        function <span class="apidocSignatureSpan">perfjankie.</span>couchData
        <span class="apidocSignatureSpan">(config, data)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">couchData = function (config, data) {
    var server = require('./utils').getCouchDB(config.couch),
        Q = require('q'),
        dfd = Q.defer();

    var db = null,
        log = config.log;

    db = server.use(config.couch.database);
    log.debug('Saving data');

    if (typeof data === 'undefined') {
        return;
    }

    db.bulk({
        docs: data.map(function (val) {
            var res = {
                url: config.url,
                data: val,
                meta: {},
                name: config.name,
                suite: config.suite,
                browser: val._browser || val._browserName,
                run: config.run || config.time,
                time: config.time,
                type: 'perfData'
            };
            for (var key in res.data) {
                if (key.indexOf('_') === 0) {
                    res.meta[key] = res.data[key];
                    delete res.data[key];
                }
            }
            return res;
        })
    }, {
        new_edits: true
    }, function (err, res) {
        log.debug('Got result back after saving data');
        err ? dfd.reject(err) : dfd.resolve(res);
    });

    return dfd.promise;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.perfjankie.couchSite" id="apidoc.module.perfjankie.couchSite">module perfjankie.couchSite</a></h1>


    <h2>
        <a href="#apidoc.element.perfjankie.couchSite.couchSite" id="apidoc.element.perfjankie.couchSite.couchSite">
        function <span class="apidocSignatureSpan">perfjankie.</span>couchSite
        <span class="apidocSignatureSpan">(config)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">couchSite = function (config) {

    var Q = require('q');

    if (!config.couch.updateSite) {
        return Q(1); // jshint ignore:line
    }

    var path = require('path'),
        log = config.log;

    var siteDest = path.join(__dirname, '../bin-site'),
        server = require('./utils').getCouchDB(config.couch),
        db = server.use(config.couch.database);

    var mime = require('./mime');

    function contentType(filename) {
        var contentType = path.extname(filename);
        if (contentType.length &gt; 0) {
            return mime[contentType.substring(1)];
        } else {
            return 'text';
        }
    }

    function readFileContents(files, siteDest) {
        var fs = require('fs'),
            path = require('path');

        var dfd = Q.defer();
        var fileContents = [];

        (function readFile(i) {
            if (i &lt; files.length) {
                fs.readFile(path.join(siteDest, files[i]), function (err, data) {
                    if (!err) {
                        fileContents.push({
                            name: files[i],
                            data: data,
                            contentType: contentType(files[i]),
                            content_type: contentType(files[i])
                        });
                    }
                    readFile(i + 1);
                });
            } else {
                log.debug('Completed reading all files');
                dfd.resolve(fileContents);
            }
        }(0));

        return dfd.promise;
    }

    function removeSite() {
        var dfd = Q.defer();
        db.get('_design/site', function (err, res) {
            if (!err) {
                db.destroy('_design/site', res._rev, function (err, res) {
                    if (err) {
                        dfd.reject(err);
                    } else {
                        dfd.resolve();
                    }
                });
            } else {
                dfd.resolve();
            }
        });
        return dfd.promise;
    }

    return removeSite().then(function () {
        return Q.nfcall(require('glob'), '**/*.*', {
            cwd: siteDest
        });
    }).then(function (files) {
        return readFileContents(files, siteDest);
    }).then(function (fileContents) {
        return Q.ninvoke(db.multipart, 'insert', {}, fileContents, '_design/site');
    }).then(function () {
        var link = url.parse([config.couch.server, config.couch.database, '_design/site/index.html'].join('/'));
        link.auth = null;
        log.info('Site Updated. View graphs at ' + url.format(link));
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.perfjankie.couchViews" id="apidoc.module.perfjankie.couchViews">module perfjankie.couchViews</a></h1>


    <h2>
        <a href="#apidoc.element.perfjankie.couchViews.couchViews" id="apidoc.element.perfjankie.couchViews.couchViews">
        function <span class="apidocSignatureSpan">perfjankie.</span>couchViews
        <span class="apidocSignatureSpan">(config)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">couchViews = function (config) {
    if (!config.couch.updateSite) {
        return Q(); // jshint ignore:line
    }

    var log = config.log,
        server = require('./utils').getCouchDB(config.couch),
        db = server.use(config.couch.database);

    return uploadViews(db, log);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.perfjankie.init" id="apidoc.module.perfjankie.init">module perfjankie.init</a></h1>


    <h2>
        <a href="#apidoc.element.perfjankie.init.init" id="apidoc.element.perfjankie.init.init">
        function <span class="apidocSignatureSpan">perfjankie.</span>init
        <span class="apidocSignatureSpan">(config)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">init = function (config) {
    var Q = require('q'),
        server = require('./utils').getCouchDB(config.couch),
        log = config.log;

    log.debug('Trying to see if the database exists');

    return Q.ninvoke(server.db, 'get', config.couch.database).catch(function (err) {
        log.debug('Could not find database: %s\nCreating a new database %s', err.reason, config.couch.database);
        return Q.ninvoke(server.db, 'create', config.couch.database);
    }).then(function () {
        var db = server.use(config.couch.database);
        return Q.ninvoke(db, 'get', 'version').catch(function (err) {
            return Q.ninvoke(db, 'insert', {
                version: require('../package.json').dbVersion
            }, 'version');
        });
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.perfjankie.metricsgen" id="apidoc.module.perfjankie.metricsgen">module perfjankie.metricsgen</a></h1>


    <h2>
        <a href="#apidoc.element.perfjankie.metricsgen.metricsgen" id="apidoc.element.perfjankie.metricsgen.metricsgen">
        function <span class="apidocSignatureSpan">perfjankie.</span>metricsgen
        <span class="apidocSignatureSpan">(grunt)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">metricsgen = function (grunt) {
	grunt.registerMultiTask('metricsgen', 'Generates the names of metrics', function() {
		var apiDocs = new browserPerf.docs();
		var regex = /(_avg|_max|_count)$/;
		var doc = {};

		for (var key in apiDocs.metrics) {
			var modifier = null;
			if (apiDocs.metrics[key].source === 'TimelineMetrics' &amp;&amp; key.match(regex)) {
				var idx = key.lastIndexOf('_');
				modifier = key.substr(idx + 1);
				key = key.substr(0, idx);
			}
			if (typeof doc[key] === 'undefined') {
				doc[key] = apiDocs.metrics[key] || {};
				doc[key].stats = [];
			}
			if (modifier) {
				doc[key].stats.push(modifier);
			}
		}

		var metrics = [];
		for (var key in doc) {
			doc[key].name = key;
			metrics.push(doc[key]);
		}

		this.files.forEach(function(file) {
			grunt.file.write(file.dest, ['var METRICS_LIST =', JSON.stringify(metrics)].join(''));
		});
	});
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.perfjankie.migrate_0_2_0" id="apidoc.module.perfjankie.migrate_0_2_0">module perfjankie.migrate_0_2_0</a></h1>


    <h2>
        <a href="#apidoc.element.perfjankie.migrate_0_2_0.migrate_0_2_0" id="apidoc.element.perfjankie.migrate_0_2_0.migrate_0_2_0">
        function <span class="apidocSignatureSpan">perfjankie.</span>migrate_0_2_0
        <span class="apidocSignatureSpan">(oldDb, newDb, config)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">migrate_0_2_0 = function (oldDb, newDb, config) {
	var log = config.log;

	return utility.forEachDoc(oldDb, newDb, function(doc) {
		if (doc.type !== 'perfData') {
			return null;
		}
		delete doc._id;
		delete doc._rev;
		doc.url = null;
		doc.browser = doc.meta._browserName || null;

		for (var key in doc.data) {
			doc.data[key] = doc.data[key].value;
		}

		doc.data[events[0]] = 0;
		for (var i = 1; i &lt; events.length; i++) {
			if (typeof doc.data[events[i]] === 'undefined') {
				doc.data[events[i]] = 0;
			}
			doc.data[events[i]] = doc.data[events[i]] + doc.data[events[i - 1]];
		}

		return doc;
	});
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.perfjankie.migrate_0_3_0" id="apidoc.module.perfjankie.migrate_0_3_0">module perfjankie.migrate_0_3_0</a></h1>


    <h2>
        <a href="#apidoc.element.perfjankie.migrate_0_3_0.migrate_0_3_0" id="apidoc.element.perfjankie.migrate_0_3_0.migrate_0_3_0">
        function <span class="apidocSignatureSpan">perfjankie.</span>migrate_0_3_0
        <span class="apidocSignatureSpan">(oldDb, newDb, config)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">migrate_0_3_0 = function (oldDb, newDb, config) {
	var log = config.log;

	return utility.forEachDoc(oldDb, newDb, function(doc) {
		if (doc.type !== 'perfData') {
			return null;
		}
		delete doc._id;
		delete doc._rev;

		for (var key in doc.data) {
			if (typeof doc.data.mean_frame_time === 'number') { // From TracingMetrics
				doc.data.frames_per_sec = 1000 / doc.data.mean_frame_time;
			}
			if (typeof doc.data.meanFrameTime === 'number') { // from RAF
				doc.data.framesPerSec_raf = 1000 / doc.data.meanFrameTime;

			}
		}

		return doc;
	});
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.perfjankie.migrate_0_4_0" id="apidoc.module.perfjankie.migrate_0_4_0">module perfjankie.migrate_0_4_0</a></h1>


    <h2>
        <a href="#apidoc.element.perfjankie.migrate_0_4_0.migrate_0_4_0" id="apidoc.element.perfjankie.migrate_0_4_0.migrate_0_4_0">
        function <span class="apidocSignatureSpan">perfjankie.</span>migrate_0_4_0
        <span class="apidocSignatureSpan">(oldDb, newDb, config)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">migrate_0_4_0 = function (oldDb, newDb, config) {
	var log = config.log;

	return utility.forEachDoc(oldDb, newDb, function(doc) {
		if (doc.type !== 'perfData') {
			return null;
		}
		delete doc._id;
		delete doc._rev;

		doc.data.meanFrameTime_raf = doc.data.meanFrameTime;

		var metrics = new Metrics(doc.data);

		metrics.addMetric('loadTime', 'loadEventEnd', 'fetchStart');
		metrics.addMetric('domReadyTime', 'domComplete', 'domInteractive');
		metrics.addMetric('readyStart', 'fetchStart', 'navigationStart');
		metrics.addMetric('redirectTime', 'redirectEnd', 'redirectStart');
		metrics.addMetric('appcacheTime', 'domainLookupStart', 'fetchStart');
		metrics.addMetric('unloadEventTime', 'unloadEventEnd', 'unloadEventStart');
		metrics.addMetric('domainLookupTime', 'domainLookupEnd', 'domainLookupStart');
		metrics.addMetric('connectTime', 'connectEnd', 'connectStart');
		metrics.addMetric('requestTime', 'responseEnd', 'requestStart');
		metrics.addMetric('initDomTreeTime', 'domInteractive', 'responseEnd');
		metrics.addMetric('loadEventTime', 'loadEventEnd', 'loadEventStart');

		return doc;
	});
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.perfjankie.options" id="apidoc.module.perfjankie.options">module perfjankie.options</a></h1>


    <h2>
        <a href="#apidoc.element.perfjankie.options.options" id="apidoc.element.perfjankie.options.options">
        function <span class="apidocSignatureSpan">perfjankie.</span>options
        <span class="apidocSignatureSpan">(config)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">options = function (config) {
	var noop = function() {};
	config.log = config.log || config.logger || noop;

	if (typeof config.log === 'function') {
		config.log = {
			'fatal': config.log,
			'error': config.log,
			'warn': config.log,
			'info': config.log,
			'debug': config.log,
			'trace': config.log
		};
	}

	function assert(expr, msg) {
		if (!expr) {
			throw new Error(msg);
		}
	}
	config.selenium = config.selenium || {
		hostname: 'localhost',
		port: 4444
	};
	config.repeat = config.repeat || 1;
	config.name = config.name || config.url;
	config.suite = config.suite || 'Default Test Suite';

	if (typeof config.callback !== 'function') {
		config.callback = noop;
	}

	if (typeof config.couch === 'undefined') {
		config.couch = {};
	}

	if (typeof config.couch.username !== 'undefined') {
		var url = require('url');
		var href = url.parse(config.couch.server);
		href.auth = config.couch.username + ':' + config.couch.pwd;
		config.couch.server = url.format(href);
	}
	assert(typeof config.couch.server !== 'undefined', 'Location to save results is not defined. Please define a couchDB server');

	config.couch.database = config.couch.db || config.couch.database;
	assert(typeof config.couch.server !== 'undefined', 'Location to save results is not defined. Please define a Database to save the
 results');
	return config;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...



module.exports = function(grunt) {
grunt.registerMultiTask('perfjankie', 'Run rendering performance test cases', function() {
  var done = this.async(),
    path = require('path'),
    options = this.<span class="apidocCodeKeywordSpan">options</span>({
      log: { // Expects the following methods,
        fatal: grunt.fail.fatal.bind(grunt.fail),
        error: grunt.fail.warn.bind(grunt.fail),
        warn: grunt.log.error.bind(grunt.log),
        info: grunt.log.ok.bind(grunt.log),
        debug: grunt.verbose.writeln.bind(grunt.verbose),
        trace: grunt.log.debug.bind(grunt.log)
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.perfjankie.perfTests" id="apidoc.module.perfjankie.perfTests">module perfjankie.perfTests</a></h1>


    <h2>
        <a href="#apidoc.element.perfjankie.perfTests.perfTests" id="apidoc.element.perfjankie.perfTests.perfTests">
        function <span class="apidocSignatureSpan">perfjankie.</span>perfTests
        <span class="apidocSignatureSpan">(config)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">perfTests = function (config) {
	var Q = require('q'),
		dfd = Q.defer();

	if (config.couch.onlyUpdateSite) {
		dfd.resolve();
	} else {
		var browserPerf = config.browserPerf || require('browser-perf'),
			log = config.log;

		log.debug('Starting Browser Perf');
		browserPerf(config.url, function(err, results) {
			if (err) {
				dfd.reject(err);
			} else {
				log.debug('Got Browser Perf results back, now saving the results');
				dfd.resolve(results);
			}
		}, {
			browsers: config.browsers,
			selenium: config.selenium,
			debug: config.debug,
			preScript: config.preScript,
			preScriptFile: config.preScriptFile,
			actions: config.actions,
			metrics: config.metrics,
			SAUCE_ACCESSKEY: config.SAUCE_ACCESSKEY || undefined,
			SAUCE_USERNAME: config.SAUCE_USERNAME || undefined,
			BROWSERSTACK_USERNAME: config.BROWSERSTACK_USERNAME || undefined,
			BROWSERSTACK_KEY: config.BROWSERSTACK_KEY || undefined
		});
	}
	return dfd.promise;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.perfjankie.task" id="apidoc.module.perfjankie.task">module perfjankie.task</a></h1>


    <h2>
        <a href="#apidoc.element.perfjankie.task.task" id="apidoc.element.perfjankie.task.task">
        function <span class="apidocSignatureSpan">perfjankie.</span>task
        <span class="apidocSignatureSpan">(grunt)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">task = function (grunt) {
  grunt.registerMultiTask('perfjankie', 'Run rendering performance test cases', function() {
    var done = this.async(),
      path = require('path'),
      options = this.options({
        log: { // Expects the following methods,
          fatal: grunt.fail.fatal.bind(grunt.fail),
          error: grunt.fail.warn.bind(grunt.fail),
          warn: grunt.log.error.bind(grunt.log),
          info: grunt.log.ok.bind(grunt.log),
          debug: grunt.verbose.writeln.bind(grunt.verbose),
          trace: grunt.log.debug.bind(grunt.log)
        },
        time: new Date().getTime()
      }),
      files = options.urls;

    options.time = parseFloat(options.time, 10);
    if (options.sauceTunnel) {
      var SauceTunnel = require('sauce-tunnel');
      grunt.log.writeln('Starting Saucelabs Tunnel');
      var tunnel = new SauceTunnel(options.SAUCE_USERNAME, options.SAUCE_ACCESSKEY, options.sauceTunnel, true);
      tunnel.start(function(status) {
        grunt.log.ok('Saucelabs Tunnel started - ' + status);
        if (status === false) {
          done(false);
        } else {
          runPerfTest(files, options, function(res) {
            grunt.verbose.writeln('All perf tests completed');
            tunnel.stop(function() {
              done(res);
            });
          });
        }
      });
    } else {
      runPerfTest(files, options, done);
    }
  });

  var perfjankie = require('..');

  var runPerfTest = function(files, options, cb) {
    var success = true;
    (function runTest(i) {
      if (i &lt; files.length) {
        grunt.log.writeln('Testing File ', files[i]);
        var config = {
          url: files[i],
          name: files[i].replace(/(\S)*\/|\.html$/gi, ''),
          callback: function(err, res) {
            if (err) {
              success = false;
              console.log(res);
              grunt.log.warn(err);
            } else {
              grunt.log.ok('Saved performance metrics');
            }
            runTest(i + 1);
          }
        };
        for (var key in options) {
          config[key] = options[key];
        }
        perfjankie(config);
      } else {
        cb(success);
      }
    }(0));
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.perfjankie.toString" id="apidoc.module.perfjankie.toString">module perfjankie.toString</a></h1>


    <h2>
        <a href="#apidoc.element.perfjankie.toString.toString" id="apidoc.element.perfjankie.toString.toString">
        function <span class="apidocSignatureSpan">perfjankie.</span>toString
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function toString() { [native code] }</pre></li>
    <li>example usage<pre class="apidocCodePre">...

log.debug('Starting to upload views');
(function uploadView(i) {
    if (i &lt; views.length) {
        log.debug('Checking View ' + views[i]);
        var view = JSON.parse(JSON.stringify(eval('_x_ = ' + fs.readFileSync(views[i], 'utf-8')), function (
key, val) {
            if (typeof val === 'function') {
                return val.<span class="apidocCodeKeywordSpan">toString</span>();
            }
            return val;
        }));
        db.get(view._id, function (err, res) {
            if (!err) {
                view._rev = res._rev;
            }
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.perfjankie.utility" id="apidoc.module.perfjankie.utility">module perfjankie.utility</a></h1>


    <h2>
        <a href="#apidoc.element.perfjankie.utility.forEachDoc" id="apidoc.element.perfjankie.utility.forEachDoc">
        function <span class="apidocSignatureSpan">perfjankie.utility.</span>forEachDoc
        <span class="apidocSignatureSpan">(oldDb, newDb, callback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">forEachDoc = function (oldDb, newDb, callback) {
		function processBatch(skip) {
			skip = skip || 0;
			var count = 0;
			return Q.ninvoke(oldDb, 'get', '_all_docs', {
				limit: MAX_LIMIT,
				skip: skip,
				include_docs: true
			}).then(function(docs) {
				count = docs[0].rows.length;
				return result = docs[0].rows.map(function(data) {
					return callback(data.doc);
				});
			}).then(function(results) {
				return Q.ninvoke(newDb, 'bulk', {
					docs: results.filter(function(val) {
						return val !== null;
					})
				}, {
					new_edits: true
				});
			}).then(function() {
				if (count &gt;= MAX_LIMIT) {
					return processBatch(skip + MAX_LIMIT);
				} else {
					return Q();
				}
			});
		}

		return processBatch();
	}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
var Q = require('q');

var utility = require('./utility');

module.exports = function(oldDb, newDb, config) {
	var log = config.log;

	return utility.<span class="apidocCodeKeywordSpan">forEachDoc</span>(oldDb, newDb, function(doc) {
		if (doc.type !== 'perfData') {
			return null;
		}
		delete doc._id;
		delete doc._rev;
		doc.url = null;
		doc.browser = doc.meta._browserName || null;
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.perfjankie.utils" id="apidoc.module.perfjankie.utils">module perfjankie.utils</a></h1>


    <h2>
        <a href="#apidoc.element.perfjankie.utils.getCouchDB" id="apidoc.element.perfjankie.utils.getCouchDB">
        function <span class="apidocSignatureSpan">perfjankie.utils.</span>getCouchDB
        <span class="apidocSignatureSpan">(options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">getCouchDB = function (options) {
    var serverUrl = options.server,
        server;
    if (options.requestOptions) {
        server = nano({
            "url": serverUrl,
            "parseUrl": false,
            "requestDefaults": options.requestOptions
        });
    } else {
        server = nano({
            "url": serverUrl,
            "parseUrl": false
        });
    }
    return server;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...






module.exports = function (config, data) {
var server = require('./utils').<span class="apidocCodeKeywordSpan">getCouchDB</span>(config.couch),
    Q = require('q'),
    dfd = Q.defer();

var db = null,
    log = config.log;

db = server.use(config.couch.database);
...</pre></li>
    </ul>


</div>

<div class="apidocFooterDiv">
    [ this document was created with
    <a href="https://github.com/kaizhu256/node-utility2" target="_blank">utility2</a>
    ]
</div>
</div>
</body></html>