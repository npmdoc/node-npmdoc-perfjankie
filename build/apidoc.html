<div class="apidocDiv">
<style>
/*csslint
*/
.apidocDiv {
    background: #fff;
    font-family: Arial, Helvetica, sans-serif;
}
.apidocDiv a[href] {
    color: #33f;
    font-weight: bold;
    text-decoration: none;
}
.apidocDiv a[href]:hover {
    text-decoration: underline;
}
.apidocCodeCommentSpan {
    background: #bbf;
    color: #000;
    display: block;
}
.apidocCodeKeywordSpan {
    color: #d00;
    font-weight: bold;
}
.apidocCodePre {
    background: #eef;
    border: 1px solid;
    color: #777;
    padding: 5px;
    white-space: pre-wrap;
}
.apidocFooterDiv {
    margin-top: 20px;
    text-align: center;
}
.apidocModuleLi {
    margin-top: 10px;
}
.apidocSectionDiv {
    border-top: 1px solid;
    margin-top: 20px;
}
.apidocSignatureSpan {
    color: #777;
    font-weight: bold;
}
</style>
<h1>api documentation for
    <a

        href="https://github.com/axemclion/perfjankie#readme"

    >perfjankie (v2.1.2)</a>
</h1>
<h4>Browser Performance regression suite</h4>
<div class="apidocSectionDiv"><a
    href="#apidoc.tableOfContents"
    id="apidoc.tableOfContents"
><h1>table of contents</h1></a><ol>

    <li class="apidocModuleLi"><a href="#apidoc.module.perfjankie">module perfjankie</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.perfjankie.perfjankie">
            function <span class="apidocSignatureSpan"></span>perfjankie
            <span class="apidocSignatureSpan">(config)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.perfjankie.couchData">
            function <span class="apidocSignatureSpan">perfjankie.</span>couchData
            <span class="apidocSignatureSpan">(config, data)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.perfjankie.couchSite">
            function <span class="apidocSignatureSpan">perfjankie.</span>couchSite
            <span class="apidocSignatureSpan">(config)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.perfjankie.couchViews">
            function <span class="apidocSignatureSpan">perfjankie.</span>couchViews
            <span class="apidocSignatureSpan">(config)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.perfjankie.init">
            function <span class="apidocSignatureSpan">perfjankie.</span>init
            <span class="apidocSignatureSpan">(config)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.perfjankie.metricsgen">
            function <span class="apidocSignatureSpan">perfjankie.</span>metricsgen
            <span class="apidocSignatureSpan">(grunt)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.perfjankie.migrate_0_2_0">
            function <span class="apidocSignatureSpan">perfjankie.</span>migrate_0_2_0
            <span class="apidocSignatureSpan">(oldDb, newDb, config)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.perfjankie.migrate_0_3_0">
            function <span class="apidocSignatureSpan">perfjankie.</span>migrate_0_3_0
            <span class="apidocSignatureSpan">(oldDb, newDb, config)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.perfjankie.migrate_0_4_0">
            function <span class="apidocSignatureSpan">perfjankie.</span>migrate_0_4_0
            <span class="apidocSignatureSpan">(oldDb, newDb, config)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.perfjankie.options">
            function <span class="apidocSignatureSpan">perfjankie.</span>options
            <span class="apidocSignatureSpan">(config)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.perfjankie.perfTests">
            function <span class="apidocSignatureSpan">perfjankie.</span>perfTests
            <span class="apidocSignatureSpan">(config)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.perfjankie.task">
            function <span class="apidocSignatureSpan">perfjankie.</span>task
            <span class="apidocSignatureSpan">(grunt)</span>
            </a>

        </li>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.perfjankie.toString">
            function <span class="apidocSignatureSpan">perfjankie.</span>toString
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">perfjankie.</span>utility</span>

        </li>

        <li>

            <span class="apidocSignatureSpan">object <span class="apidocSignatureSpan">perfjankie.</span>utils</span>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.perfjankie.couchData">module perfjankie.couchData</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.perfjankie.couchData.couchData">
            function <span class="apidocSignatureSpan">perfjankie.</span>couchData
            <span class="apidocSignatureSpan">(config, data)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.perfjankie.couchSite">module perfjankie.couchSite</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.perfjankie.couchSite.couchSite">
            function <span class="apidocSignatureSpan">perfjankie.</span>couchSite
            <span class="apidocSignatureSpan">(config)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.perfjankie.couchViews">module perfjankie.couchViews</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.perfjankie.couchViews.couchViews">
            function <span class="apidocSignatureSpan">perfjankie.</span>couchViews
            <span class="apidocSignatureSpan">(config)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.perfjankie.init">module perfjankie.init</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.perfjankie.init.init">
            function <span class="apidocSignatureSpan">perfjankie.</span>init
            <span class="apidocSignatureSpan">(config)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.perfjankie.metricsgen">module perfjankie.metricsgen</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.perfjankie.metricsgen.metricsgen">
            function <span class="apidocSignatureSpan">perfjankie.</span>metricsgen
            <span class="apidocSignatureSpan">(grunt)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.perfjankie.migrate_0_2_0">module perfjankie.migrate_0_2_0</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.perfjankie.migrate_0_2_0.migrate_0_2_0">
            function <span class="apidocSignatureSpan">perfjankie.</span>migrate_0_2_0
            <span class="apidocSignatureSpan">(oldDb, newDb, config)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.perfjankie.migrate_0_3_0">module perfjankie.migrate_0_3_0</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.perfjankie.migrate_0_3_0.migrate_0_3_0">
            function <span class="apidocSignatureSpan">perfjankie.</span>migrate_0_3_0
            <span class="apidocSignatureSpan">(oldDb, newDb, config)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.perfjankie.migrate_0_4_0">module perfjankie.migrate_0_4_0</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.perfjankie.migrate_0_4_0.migrate_0_4_0">
            function <span class="apidocSignatureSpan">perfjankie.</span>migrate_0_4_0
            <span class="apidocSignatureSpan">(oldDb, newDb, config)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.perfjankie.options">module perfjankie.options</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.perfjankie.options.options">
            function <span class="apidocSignatureSpan">perfjankie.</span>options
            <span class="apidocSignatureSpan">(config)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.perfjankie.perfTests">module perfjankie.perfTests</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.perfjankie.perfTests.perfTests">
            function <span class="apidocSignatureSpan">perfjankie.</span>perfTests
            <span class="apidocSignatureSpan">(config)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.perfjankie.task">module perfjankie.task</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.perfjankie.task.task">
            function <span class="apidocSignatureSpan">perfjankie.</span>task
            <span class="apidocSignatureSpan">(grunt)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.perfjankie.toString">module perfjankie.toString</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.perfjankie.toString.toString">
            function <span class="apidocSignatureSpan">perfjankie.</span>toString
            <span class="apidocSignatureSpan">()</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.perfjankie.utility">module perfjankie.utility</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.perfjankie.utility.forEachDoc">
            function <span class="apidocSignatureSpan">perfjankie.utility.</span>forEachDoc
            <span class="apidocSignatureSpan">(oldDb, newDb, callback)</span>
            </a>

        </li>

    </ol></li>

    <li class="apidocModuleLi"><a href="#apidoc.module.perfjankie.utils">module perfjankie.utils</a><ol>

        <li>

            <a class="apidocElementLiA" href="#apidoc.element.perfjankie.utils.getCouchDB">
            function <span class="apidocSignatureSpan">perfjankie.utils.</span>getCouchDB
            <span class="apidocSignatureSpan">(options)</span>
            </a>

        </li>

    </ol></li>

</ol></div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.perfjankie" id="apidoc.module.perfjankie">module perfjankie</a></h1>


    <h2>
        <a href="#apidoc.element.perfjankie.perfjankie" id="apidoc.element.perfjankie.perfjankie">
        function <span class="apidocSignatureSpan"></span>perfjankie
        <span class="apidocSignatureSpan">(config)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">perfjankie = function (config) {
	var options = require(&#x27;./options&#x27;)(config),
		log = options.log,
		cb = options.callback;

	log.info(&#x27;Starting PerfJankie&#x27;);

	init(config).then(function() {
		return runTests(config);
	}).then(function() {
		return Q.allSettled([site(config), views(config)]);
	}).then(function(res) {
		log.debug(&#x27;Successfully done all tasks&#x27;);
		cb(null, res);
	}, function(err) {
		log.debug(err);
		cb(err, null);
	}).done();
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.perfjankie.couchData" id="apidoc.element.perfjankie.couchData">
        function <span class="apidocSignatureSpan">perfjankie.</span>couchData
        <span class="apidocSignatureSpan">(config, data)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">couchData = function (config, data) {
    var server = require(&#x27;./utils&#x27;).getCouchDB(config.couch),
        Q = require(&#x27;q&#x27;),
        dfd = Q.defer();

    var db = null,
        log = config.log;

    db = server.use(config.couch.database);
    log.debug(&#x27;Saving data&#x27;);

    if (typeof data === &#x27;undefined&#x27;) {
        return;
    }

    db.bulk({
        docs: data.map(function (val) {
            var res = {
                url: config.url,
                data: val,
                meta: {},
                name: config.name,
                suite: config.suite,
                browser: val._browser || val._browserName,
                run: config.run || config.time,
                time: config.time,
                type: &#x27;perfData&#x27;
            };
            for (var key in res.data) {
                if (key.indexOf(&#x27;_&#x27;) === 0) {
                    res.meta[key] = res.data[key];
                    delete res.data[key];
                }
            }
            return res;
        })
    }, {
        new_edits: true
    }, function (err, res) {
        log.debug(&#x27;Got result back after saving data&#x27;);
        err ? dfd.reject(err) : dfd.resolve(res);
    });

    return dfd.promise;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.perfjankie.couchSite" id="apidoc.element.perfjankie.couchSite">
        function <span class="apidocSignatureSpan">perfjankie.</span>couchSite
        <span class="apidocSignatureSpan">(config)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">couchSite = function (config) {

    var Q = require(&#x27;q&#x27;);

    if (!config.couch.updateSite) {
        return Q(1); // jshint ignore:line
    }

    var path = require(&#x27;path&#x27;),
        log = config.log;

    var siteDest = path.join(__dirname, &#x27;../bin-site&#x27;),
        server = require(&#x27;./utils&#x27;).getCouchDB(config.couch),
        db = server.use(config.couch.database);

    var mime = require(&#x27;./mime&#x27;);

    function contentType(filename) {
        var contentType = path.extname(filename);
        if (contentType.length &#x3e; 0) {
            return mime[contentType.substring(1)];
        } else {
            return &#x27;text&#x27;;
        }
    }

    function readFileContents(files, siteDest) {
        var fs = require(&#x27;fs&#x27;),
            path = require(&#x27;path&#x27;);

        var dfd = Q.defer();
        var fileContents = [];

        (function readFile(i) {
            if (i &#x3c; files.length) {
                fs.readFile(path.join(siteDest, files[i]), function (err, data) {
                    if (!err) {
                        fileContents.push({
                            name: files[i],
                            data: data,
                            contentType: contentType(files[i]),
                            content_type: contentType(files[i])
                        });
                    }
                    readFile(i + 1);
                });
            } else {
                log.debug(&#x27;Completed reading all files&#x27;);
                dfd.resolve(fileContents);
            }
        }(0));

        return dfd.promise;
    }

    function removeSite() {
        var dfd = Q.defer();
        db.get(&#x27;_design/site&#x27;, function (err, res) {
            if (!err) {
                db.destroy(&#x27;_design/site&#x27;, res._rev, function (err, res) {
                    if (err) {
                        dfd.reject(err);
                    } else {
                        dfd.resolve();
                    }
                });
            } else {
                dfd.resolve();
            }
        });
        return dfd.promise;
    }

    return removeSite().then(function () {
        return Q.nfcall(require(&#x27;glob&#x27;), &#x27;**/*.*&#x27;, {
            cwd: siteDest
        });
    }).then(function (files) {
        return readFileContents(files, siteDest);
    }).then(function (fileContents) {
        return Q.ninvoke(db.multipart, &#x27;insert&#x27;, {}, fileContents, &#x27;_design/site&#x27;);
    }).then(function () {
        var link = url.parse([config.couch.server, config.couch.database, &#x27;_design/site/index.html&#x27;].join(&#x27;/&#x27;));
        link.auth = null;
        log.info(&#x27;Site Updated. View graphs at &#x27; + url.format(link));
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.perfjankie.couchViews" id="apidoc.element.perfjankie.couchViews">
        function <span class="apidocSignatureSpan">perfjankie.</span>couchViews
        <span class="apidocSignatureSpan">(config)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">couchViews = function (config) {
    if (!config.couch.updateSite) {
        return Q(); // jshint ignore:line
    }

    var log = config.log,
        server = require(&#x27;./utils&#x27;).getCouchDB(config.couch),
        db = server.use(config.couch.database);

    return uploadViews(db, log);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.perfjankie.init" id="apidoc.element.perfjankie.init">
        function <span class="apidocSignatureSpan">perfjankie.</span>init
        <span class="apidocSignatureSpan">(config)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">init = function (config) {
    var Q = require(&#x27;q&#x27;),
        server = require(&#x27;./utils&#x27;).getCouchDB(config.couch),
        log = config.log;

    log.debug(&#x27;Trying to see if the database exists&#x27;);

    return Q.ninvoke(server.db, &#x27;get&#x27;, config.couch.database).catch(function (err) {
        log.debug(&#x27;Could not find database: %s\nCreating a new database %s&#x27;, err.reason, config.couch.database);
        return Q.ninvoke(server.db, &#x27;create&#x27;, config.couch.database);
    }).then(function () {
        var db = server.use(config.couch.database);
        return Q.ninvoke(db, &#x27;get&#x27;, &#x27;version&#x27;).catch(function (err) {
            return Q.ninvoke(db, &#x27;insert&#x27;, {
                version: require(&#x27;../package.json&#x27;).dbVersion
            }, &#x27;version&#x27;);
        });
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.perfjankie.metricsgen" id="apidoc.element.perfjankie.metricsgen">
        function <span class="apidocSignatureSpan">perfjankie.</span>metricsgen
        <span class="apidocSignatureSpan">(grunt)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">metricsgen = function (grunt) {
	grunt.registerMultiTask(&#x27;metricsgen&#x27;, &#x27;Generates the names of metrics&#x27;, function() {
		var apiDocs = new browserPerf.docs();
		var regex = /(_avg|_max|_count)$/;
		var doc = {};

		for (var key in apiDocs.metrics) {
			var modifier = null;
			if (apiDocs.metrics[key].source === &#x27;TimelineMetrics&#x27; &#x26;&#x26; key.match(regex)) {
				var idx = key.lastIndexOf(&#x27;_&#x27;);
				modifier = key.substr(idx + 1);
				key = key.substr(0, idx);
			}
			if (typeof doc[key] === &#x27;undefined&#x27;) {
				doc[key] = apiDocs.metrics[key] || {};
				doc[key].stats = [];
			}
			if (modifier) {
				doc[key].stats.push(modifier);
			}
		}

		var metrics = [];
		for (var key in doc) {
			doc[key].name = key;
			metrics.push(doc[key]);
		}

		this.files.forEach(function(file) {
			grunt.file.write(file.dest, [&#x27;var METRICS_LIST =&#x27;, JSON.stringify(metrics)].join(&#x27;&#x27;));
		});
	});
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.perfjankie.migrate_0_2_0" id="apidoc.element.perfjankie.migrate_0_2_0">
        function <span class="apidocSignatureSpan">perfjankie.</span>migrate_0_2_0
        <span class="apidocSignatureSpan">(oldDb, newDb, config)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">migrate_0_2_0 = function (oldDb, newDb, config) {
	var log = config.log;

	return utility.forEachDoc(oldDb, newDb, function(doc) {
		if (doc.type !== &#x27;perfData&#x27;) {
			return null;
		}
		delete doc._id;
		delete doc._rev;
		doc.url = null;
		doc.browser = doc.meta._browserName || null;

		for (var key in doc.data) {
			doc.data[key] = doc.data[key].value;
		}

		doc.data[events[0]] = 0;
		for (var i = 1; i &#x3c; events.length; i++) {
			if (typeof doc.data[events[i]] === &#x27;undefined&#x27;) {
				doc.data[events[i]] = 0;
			}
			doc.data[events[i]] = doc.data[events[i]] + doc.data[events[i - 1]];
		}

		return doc;
	});
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.perfjankie.migrate_0_3_0" id="apidoc.element.perfjankie.migrate_0_3_0">
        function <span class="apidocSignatureSpan">perfjankie.</span>migrate_0_3_0
        <span class="apidocSignatureSpan">(oldDb, newDb, config)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">migrate_0_3_0 = function (oldDb, newDb, config) {
	var log = config.log;

	return utility.forEachDoc(oldDb, newDb, function(doc) {
		if (doc.type !== &#x27;perfData&#x27;) {
			return null;
		}
		delete doc._id;
		delete doc._rev;

		for (var key in doc.data) {
			if (typeof doc.data.mean_frame_time === &#x27;number&#x27;) { // From TracingMetrics
				doc.data.frames_per_sec = 1000 / doc.data.mean_frame_time;
			}
			if (typeof doc.data.meanFrameTime === &#x27;number&#x27;) { // from RAF
				doc.data.framesPerSec_raf = 1000 / doc.data.meanFrameTime;

			}
		}

		return doc;
	});
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.perfjankie.migrate_0_4_0" id="apidoc.element.perfjankie.migrate_0_4_0">
        function <span class="apidocSignatureSpan">perfjankie.</span>migrate_0_4_0
        <span class="apidocSignatureSpan">(oldDb, newDb, config)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">migrate_0_4_0 = function (oldDb, newDb, config) {
	var log = config.log;

	return utility.forEachDoc(oldDb, newDb, function(doc) {
		if (doc.type !== &#x27;perfData&#x27;) {
			return null;
		}
		delete doc._id;
		delete doc._rev;

		doc.data.meanFrameTime_raf = doc.data.meanFrameTime;

		var metrics = new Metrics(doc.data);

		metrics.addMetric(&#x27;loadTime&#x27;, &#x27;loadEventEnd&#x27;, &#x27;fetchStart&#x27;);
		metrics.addMetric(&#x27;domReadyTime&#x27;, &#x27;domComplete&#x27;, &#x27;domInteractive&#x27;);
		metrics.addMetric(&#x27;readyStart&#x27;, &#x27;fetchStart&#x27;, &#x27;navigationStart&#x27;);
		metrics.addMetric(&#x27;redirectTime&#x27;, &#x27;redirectEnd&#x27;, &#x27;redirectStart&#x27;);
		metrics.addMetric(&#x27;appcacheTime&#x27;, &#x27;domainLookupStart&#x27;, &#x27;fetchStart&#x27;);
		metrics.addMetric(&#x27;unloadEventTime&#x27;, &#x27;unloadEventEnd&#x27;, &#x27;unloadEventStart&#x27;);
		metrics.addMetric(&#x27;domainLookupTime&#x27;, &#x27;domainLookupEnd&#x27;, &#x27;domainLookupStart&#x27;);
		metrics.addMetric(&#x27;connectTime&#x27;, &#x27;connectEnd&#x27;, &#x27;connectStart&#x27;);
		metrics.addMetric(&#x27;requestTime&#x27;, &#x27;responseEnd&#x27;, &#x27;requestStart&#x27;);
		metrics.addMetric(&#x27;initDomTreeTime&#x27;, &#x27;domInteractive&#x27;, &#x27;responseEnd&#x27;);
		metrics.addMetric(&#x27;loadEventTime&#x27;, &#x27;loadEventEnd&#x27;, &#x27;loadEventStart&#x27;);

		return doc;
	});
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.perfjankie.options" id="apidoc.element.perfjankie.options">
        function <span class="apidocSignatureSpan">perfjankie.</span>options
        <span class="apidocSignatureSpan">(config)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">options = function (config) {
	var noop = function() {};
	config.log = config.log || config.logger || noop;

	if (typeof config.log === &#x27;function&#x27;) {
		config.log = {
			&#x27;fatal&#x27;: config.log,
			&#x27;error&#x27;: config.log,
			&#x27;warn&#x27;: config.log,
			&#x27;info&#x27;: config.log,
			&#x27;debug&#x27;: config.log,
			&#x27;trace&#x27;: config.log
		};
	}

	function assert(expr, msg) {
		if (!expr) {
			throw new Error(msg);
		}
	}
	config.selenium = config.selenium || {
		hostname: &#x27;localhost&#x27;,
		port: 4444
	};
	config.repeat = config.repeat || 1;
	config.name = config.name || config.url;
	config.suite = config.suite || &#x27;Default Test Suite&#x27;;

	if (typeof config.callback !== &#x27;function&#x27;) {
		config.callback = noop;
	}

	if (typeof config.couch === &#x27;undefined&#x27;) {
		config.couch = {};
	}

	if (typeof config.couch.username !== &#x27;undefined&#x27;) {
		var url = require(&#x27;url&#x27;);
		var href = url.parse(config.couch.server);
		href.auth = config.couch.username + &#x27;:&#x27; + config.couch.pwd;
		config.couch.server = url.format(href);
	}
	assert(typeof config.couch.server !== &#x27;undefined&#x27;, &#x27;Location to save results is not defined. Please define a couchDB server&#x27;);

	config.couch.database = config.couch.db || config.couch.database;
	assert(typeof config.couch.server !== &#x27;undefined&#x27;, &#x27;Location to save results is not defined. Please define a Database to save the
 results&#x27;);
	return config;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...



module.exports = function(grunt) {
grunt.registerMultiTask(&#x27;perfjankie&#x27;, &#x27;Run rendering performance test cases&#x27;, function() {
  var done = this.async(),
    path = require(&#x27;path&#x27;),
    options = this.<span class="apidocCodeKeywordSpan">options</span>({
      log: { // Expects the following methods,
        fatal: grunt.fail.fatal.bind(grunt.fail),
        error: grunt.fail.warn.bind(grunt.fail),
        warn: grunt.log.error.bind(grunt.log),
        info: grunt.log.ok.bind(grunt.log),
        debug: grunt.verbose.writeln.bind(grunt.verbose),
        trace: grunt.log.debug.bind(grunt.log)
...</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.perfjankie.perfTests" id="apidoc.element.perfjankie.perfTests">
        function <span class="apidocSignatureSpan">perfjankie.</span>perfTests
        <span class="apidocSignatureSpan">(config)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">perfTests = function (config) {
	var Q = require(&#x27;q&#x27;),
		dfd = Q.defer();

	if (config.couch.onlyUpdateSite) {
		dfd.resolve();
	} else {
		var browserPerf = config.browserPerf || require(&#x27;browser-perf&#x27;),
			log = config.log;

		log.debug(&#x27;Starting Browser Perf&#x27;);
		browserPerf(config.url, function(err, results) {
			if (err) {
				dfd.reject(err);
			} else {
				log.debug(&#x27;Got Browser Perf results back, now saving the results&#x27;);
				dfd.resolve(results);
			}
		}, {
			browsers: config.browsers,
			selenium: config.selenium,
			debug: config.debug,
			preScript: config.preScript,
			preScriptFile: config.preScriptFile,
			actions: config.actions,
			metrics: config.metrics,
			SAUCE_ACCESSKEY: config.SAUCE_ACCESSKEY || undefined,
			SAUCE_USERNAME: config.SAUCE_USERNAME || undefined,
			BROWSERSTACK_USERNAME: config.BROWSERSTACK_USERNAME || undefined,
			BROWSERSTACK_KEY: config.BROWSERSTACK_KEY || undefined
		});
	}
	return dfd.promise;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.perfjankie.task" id="apidoc.element.perfjankie.task">
        function <span class="apidocSignatureSpan">perfjankie.</span>task
        <span class="apidocSignatureSpan">(grunt)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">task = function (grunt) {
  grunt.registerMultiTask(&#x27;perfjankie&#x27;, &#x27;Run rendering performance test cases&#x27;, function() {
    var done = this.async(),
      path = require(&#x27;path&#x27;),
      options = this.options({
        log: { // Expects the following methods,
          fatal: grunt.fail.fatal.bind(grunt.fail),
          error: grunt.fail.warn.bind(grunt.fail),
          warn: grunt.log.error.bind(grunt.log),
          info: grunt.log.ok.bind(grunt.log),
          debug: grunt.verbose.writeln.bind(grunt.verbose),
          trace: grunt.log.debug.bind(grunt.log)
        },
        time: new Date().getTime()
      }),
      files = options.urls;

    options.time = parseFloat(options.time, 10);
    if (options.sauceTunnel) {
      var SauceTunnel = require(&#x27;sauce-tunnel&#x27;);
      grunt.log.writeln(&#x27;Starting Saucelabs Tunnel&#x27;);
      var tunnel = new SauceTunnel(options.SAUCE_USERNAME, options.SAUCE_ACCESSKEY, options.sauceTunnel, true);
      tunnel.start(function(status) {
        grunt.log.ok(&#x27;Saucelabs Tunnel started - &#x27; + status);
        if (status === false) {
          done(false);
        } else {
          runPerfTest(files, options, function(res) {
            grunt.verbose.writeln(&#x27;All perf tests completed&#x27;);
            tunnel.stop(function() {
              done(res);
            });
          });
        }
      });
    } else {
      runPerfTest(files, options, done);
    }
  });

  var perfjankie = require(&#x27;..&#x27;);

  var runPerfTest = function(files, options, cb) {
    var success = true;
    (function runTest(i) {
      if (i &#x3c; files.length) {
        grunt.log.writeln(&#x27;Testing File &#x27;, files[i]);
        var config = {
          url: files[i],
          name: files[i].replace(/(\S)*\/|\.html$/gi, &#x27;&#x27;),
          callback: function(err, res) {
            if (err) {
              success = false;
              console.log(res);
              grunt.log.warn(err);
            } else {
              grunt.log.ok(&#x27;Saved performance metrics&#x27;);
            }
            runTest(i + 1);
          }
        };
        for (var key in options) {
          config[key] = options[key];
        }
        perfjankie(config);
      } else {
        cb(success);
      }
    }(0));
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>



    <h2>
        <a href="#apidoc.element.perfjankie.toString" id="apidoc.element.perfjankie.toString">
        function <span class="apidocSignatureSpan">perfjankie.</span>toString
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">toString = function () {
    return text;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...

log.debug(&#x27;Starting to upload views&#x27;);
(function uploadView(i) {
    if (i &#x3c; views.length) {
        log.debug(&#x27;Checking View &#x27; + views[i]);
        var view = JSON.parse(JSON.stringify(eval(&#x27;_x_ = &#x27; + fs.readFileSync(views[i], &#x27;utf-8&#x27;)), function (
key, val) {
            if (typeof val === &#x27;function&#x27;) {
                return val.<span class="apidocCodeKeywordSpan">toString</span>();
            }
            return val;
        }));
        db.get(view._id, function (err, res) {
            if (!err) {
                view._rev = res._rev;
            }
...</pre></li>
    </ul>






</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.perfjankie.couchData" id="apidoc.module.perfjankie.couchData">module perfjankie.couchData</a></h1>


    <h2>
        <a href="#apidoc.element.perfjankie.couchData.couchData" id="apidoc.element.perfjankie.couchData.couchData">
        function <span class="apidocSignatureSpan">perfjankie.</span>couchData
        <span class="apidocSignatureSpan">(config, data)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">couchData = function (config, data) {
    var server = require(&#x27;./utils&#x27;).getCouchDB(config.couch),
        Q = require(&#x27;q&#x27;),
        dfd = Q.defer();

    var db = null,
        log = config.log;

    db = server.use(config.couch.database);
    log.debug(&#x27;Saving data&#x27;);

    if (typeof data === &#x27;undefined&#x27;) {
        return;
    }

    db.bulk({
        docs: data.map(function (val) {
            var res = {
                url: config.url,
                data: val,
                meta: {},
                name: config.name,
                suite: config.suite,
                browser: val._browser || val._browserName,
                run: config.run || config.time,
                time: config.time,
                type: &#x27;perfData&#x27;
            };
            for (var key in res.data) {
                if (key.indexOf(&#x27;_&#x27;) === 0) {
                    res.meta[key] = res.data[key];
                    delete res.data[key];
                }
            }
            return res;
        })
    }, {
        new_edits: true
    }, function (err, res) {
        log.debug(&#x27;Got result back after saving data&#x27;);
        err ? dfd.reject(err) : dfd.resolve(res);
    });

    return dfd.promise;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.perfjankie.couchSite" id="apidoc.module.perfjankie.couchSite">module perfjankie.couchSite</a></h1>


    <h2>
        <a href="#apidoc.element.perfjankie.couchSite.couchSite" id="apidoc.element.perfjankie.couchSite.couchSite">
        function <span class="apidocSignatureSpan">perfjankie.</span>couchSite
        <span class="apidocSignatureSpan">(config)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">couchSite = function (config) {

    var Q = require(&#x27;q&#x27;);

    if (!config.couch.updateSite) {
        return Q(1); // jshint ignore:line
    }

    var path = require(&#x27;path&#x27;),
        log = config.log;

    var siteDest = path.join(__dirname, &#x27;../bin-site&#x27;),
        server = require(&#x27;./utils&#x27;).getCouchDB(config.couch),
        db = server.use(config.couch.database);

    var mime = require(&#x27;./mime&#x27;);

    function contentType(filename) {
        var contentType = path.extname(filename);
        if (contentType.length &#x3e; 0) {
            return mime[contentType.substring(1)];
        } else {
            return &#x27;text&#x27;;
        }
    }

    function readFileContents(files, siteDest) {
        var fs = require(&#x27;fs&#x27;),
            path = require(&#x27;path&#x27;);

        var dfd = Q.defer();
        var fileContents = [];

        (function readFile(i) {
            if (i &#x3c; files.length) {
                fs.readFile(path.join(siteDest, files[i]), function (err, data) {
                    if (!err) {
                        fileContents.push({
                            name: files[i],
                            data: data,
                            contentType: contentType(files[i]),
                            content_type: contentType(files[i])
                        });
                    }
                    readFile(i + 1);
                });
            } else {
                log.debug(&#x27;Completed reading all files&#x27;);
                dfd.resolve(fileContents);
            }
        }(0));

        return dfd.promise;
    }

    function removeSite() {
        var dfd = Q.defer();
        db.get(&#x27;_design/site&#x27;, function (err, res) {
            if (!err) {
                db.destroy(&#x27;_design/site&#x27;, res._rev, function (err, res) {
                    if (err) {
                        dfd.reject(err);
                    } else {
                        dfd.resolve();
                    }
                });
            } else {
                dfd.resolve();
            }
        });
        return dfd.promise;
    }

    return removeSite().then(function () {
        return Q.nfcall(require(&#x27;glob&#x27;), &#x27;**/*.*&#x27;, {
            cwd: siteDest
        });
    }).then(function (files) {
        return readFileContents(files, siteDest);
    }).then(function (fileContents) {
        return Q.ninvoke(db.multipart, &#x27;insert&#x27;, {}, fileContents, &#x27;_design/site&#x27;);
    }).then(function () {
        var link = url.parse([config.couch.server, config.couch.database, &#x27;_design/site/index.html&#x27;].join(&#x27;/&#x27;));
        link.auth = null;
        log.info(&#x27;Site Updated. View graphs at &#x27; + url.format(link));
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.perfjankie.couchViews" id="apidoc.module.perfjankie.couchViews">module perfjankie.couchViews</a></h1>


    <h2>
        <a href="#apidoc.element.perfjankie.couchViews.couchViews" id="apidoc.element.perfjankie.couchViews.couchViews">
        function <span class="apidocSignatureSpan">perfjankie.</span>couchViews
        <span class="apidocSignatureSpan">(config)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">couchViews = function (config) {
    if (!config.couch.updateSite) {
        return Q(); // jshint ignore:line
    }

    var log = config.log,
        server = require(&#x27;./utils&#x27;).getCouchDB(config.couch),
        db = server.use(config.couch.database);

    return uploadViews(db, log);
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.perfjankie.init" id="apidoc.module.perfjankie.init">module perfjankie.init</a></h1>


    <h2>
        <a href="#apidoc.element.perfjankie.init.init" id="apidoc.element.perfjankie.init.init">
        function <span class="apidocSignatureSpan">perfjankie.</span>init
        <span class="apidocSignatureSpan">(config)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">init = function (config) {
    var Q = require(&#x27;q&#x27;),
        server = require(&#x27;./utils&#x27;).getCouchDB(config.couch),
        log = config.log;

    log.debug(&#x27;Trying to see if the database exists&#x27;);

    return Q.ninvoke(server.db, &#x27;get&#x27;, config.couch.database).catch(function (err) {
        log.debug(&#x27;Could not find database: %s\nCreating a new database %s&#x27;, err.reason, config.couch.database);
        return Q.ninvoke(server.db, &#x27;create&#x27;, config.couch.database);
    }).then(function () {
        var db = server.use(config.couch.database);
        return Q.ninvoke(db, &#x27;get&#x27;, &#x27;version&#x27;).catch(function (err) {
            return Q.ninvoke(db, &#x27;insert&#x27;, {
                version: require(&#x27;../package.json&#x27;).dbVersion
            }, &#x27;version&#x27;);
        });
    });
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.perfjankie.metricsgen" id="apidoc.module.perfjankie.metricsgen">module perfjankie.metricsgen</a></h1>


    <h2>
        <a href="#apidoc.element.perfjankie.metricsgen.metricsgen" id="apidoc.element.perfjankie.metricsgen.metricsgen">
        function <span class="apidocSignatureSpan">perfjankie.</span>metricsgen
        <span class="apidocSignatureSpan">(grunt)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">metricsgen = function (grunt) {
	grunt.registerMultiTask(&#x27;metricsgen&#x27;, &#x27;Generates the names of metrics&#x27;, function() {
		var apiDocs = new browserPerf.docs();
		var regex = /(_avg|_max|_count)$/;
		var doc = {};

		for (var key in apiDocs.metrics) {
			var modifier = null;
			if (apiDocs.metrics[key].source === &#x27;TimelineMetrics&#x27; &#x26;&#x26; key.match(regex)) {
				var idx = key.lastIndexOf(&#x27;_&#x27;);
				modifier = key.substr(idx + 1);
				key = key.substr(0, idx);
			}
			if (typeof doc[key] === &#x27;undefined&#x27;) {
				doc[key] = apiDocs.metrics[key] || {};
				doc[key].stats = [];
			}
			if (modifier) {
				doc[key].stats.push(modifier);
			}
		}

		var metrics = [];
		for (var key in doc) {
			doc[key].name = key;
			metrics.push(doc[key]);
		}

		this.files.forEach(function(file) {
			grunt.file.write(file.dest, [&#x27;var METRICS_LIST =&#x27;, JSON.stringify(metrics)].join(&#x27;&#x27;));
		});
	});
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.perfjankie.migrate_0_2_0" id="apidoc.module.perfjankie.migrate_0_2_0">module perfjankie.migrate_0_2_0</a></h1>


    <h2>
        <a href="#apidoc.element.perfjankie.migrate_0_2_0.migrate_0_2_0" id="apidoc.element.perfjankie.migrate_0_2_0.migrate_0_2_0">
        function <span class="apidocSignatureSpan">perfjankie.</span>migrate_0_2_0
        <span class="apidocSignatureSpan">(oldDb, newDb, config)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">migrate_0_2_0 = function (oldDb, newDb, config) {
	var log = config.log;

	return utility.forEachDoc(oldDb, newDb, function(doc) {
		if (doc.type !== &#x27;perfData&#x27;) {
			return null;
		}
		delete doc._id;
		delete doc._rev;
		doc.url = null;
		doc.browser = doc.meta._browserName || null;

		for (var key in doc.data) {
			doc.data[key] = doc.data[key].value;
		}

		doc.data[events[0]] = 0;
		for (var i = 1; i &#x3c; events.length; i++) {
			if (typeof doc.data[events[i]] === &#x27;undefined&#x27;) {
				doc.data[events[i]] = 0;
			}
			doc.data[events[i]] = doc.data[events[i]] + doc.data[events[i - 1]];
		}

		return doc;
	});
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.perfjankie.migrate_0_3_0" id="apidoc.module.perfjankie.migrate_0_3_0">module perfjankie.migrate_0_3_0</a></h1>


    <h2>
        <a href="#apidoc.element.perfjankie.migrate_0_3_0.migrate_0_3_0" id="apidoc.element.perfjankie.migrate_0_3_0.migrate_0_3_0">
        function <span class="apidocSignatureSpan">perfjankie.</span>migrate_0_3_0
        <span class="apidocSignatureSpan">(oldDb, newDb, config)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">migrate_0_3_0 = function (oldDb, newDb, config) {
	var log = config.log;

	return utility.forEachDoc(oldDb, newDb, function(doc) {
		if (doc.type !== &#x27;perfData&#x27;) {
			return null;
		}
		delete doc._id;
		delete doc._rev;

		for (var key in doc.data) {
			if (typeof doc.data.mean_frame_time === &#x27;number&#x27;) { // From TracingMetrics
				doc.data.frames_per_sec = 1000 / doc.data.mean_frame_time;
			}
			if (typeof doc.data.meanFrameTime === &#x27;number&#x27;) { // from RAF
				doc.data.framesPerSec_raf = 1000 / doc.data.meanFrameTime;

			}
		}

		return doc;
	});
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.perfjankie.migrate_0_4_0" id="apidoc.module.perfjankie.migrate_0_4_0">module perfjankie.migrate_0_4_0</a></h1>


    <h2>
        <a href="#apidoc.element.perfjankie.migrate_0_4_0.migrate_0_4_0" id="apidoc.element.perfjankie.migrate_0_4_0.migrate_0_4_0">
        function <span class="apidocSignatureSpan">perfjankie.</span>migrate_0_4_0
        <span class="apidocSignatureSpan">(oldDb, newDb, config)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">migrate_0_4_0 = function (oldDb, newDb, config) {
	var log = config.log;

	return utility.forEachDoc(oldDb, newDb, function(doc) {
		if (doc.type !== &#x27;perfData&#x27;) {
			return null;
		}
		delete doc._id;
		delete doc._rev;

		doc.data.meanFrameTime_raf = doc.data.meanFrameTime;

		var metrics = new Metrics(doc.data);

		metrics.addMetric(&#x27;loadTime&#x27;, &#x27;loadEventEnd&#x27;, &#x27;fetchStart&#x27;);
		metrics.addMetric(&#x27;domReadyTime&#x27;, &#x27;domComplete&#x27;, &#x27;domInteractive&#x27;);
		metrics.addMetric(&#x27;readyStart&#x27;, &#x27;fetchStart&#x27;, &#x27;navigationStart&#x27;);
		metrics.addMetric(&#x27;redirectTime&#x27;, &#x27;redirectEnd&#x27;, &#x27;redirectStart&#x27;);
		metrics.addMetric(&#x27;appcacheTime&#x27;, &#x27;domainLookupStart&#x27;, &#x27;fetchStart&#x27;);
		metrics.addMetric(&#x27;unloadEventTime&#x27;, &#x27;unloadEventEnd&#x27;, &#x27;unloadEventStart&#x27;);
		metrics.addMetric(&#x27;domainLookupTime&#x27;, &#x27;domainLookupEnd&#x27;, &#x27;domainLookupStart&#x27;);
		metrics.addMetric(&#x27;connectTime&#x27;, &#x27;connectEnd&#x27;, &#x27;connectStart&#x27;);
		metrics.addMetric(&#x27;requestTime&#x27;, &#x27;responseEnd&#x27;, &#x27;requestStart&#x27;);
		metrics.addMetric(&#x27;initDomTreeTime&#x27;, &#x27;domInteractive&#x27;, &#x27;responseEnd&#x27;);
		metrics.addMetric(&#x27;loadEventTime&#x27;, &#x27;loadEventEnd&#x27;, &#x27;loadEventStart&#x27;);

		return doc;
	});
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.perfjankie.options" id="apidoc.module.perfjankie.options">module perfjankie.options</a></h1>


    <h2>
        <a href="#apidoc.element.perfjankie.options.options" id="apidoc.element.perfjankie.options.options">
        function <span class="apidocSignatureSpan">perfjankie.</span>options
        <span class="apidocSignatureSpan">(config)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">options = function (config) {
	var noop = function() {};
	config.log = config.log || config.logger || noop;

	if (typeof config.log === &#x27;function&#x27;) {
		config.log = {
			&#x27;fatal&#x27;: config.log,
			&#x27;error&#x27;: config.log,
			&#x27;warn&#x27;: config.log,
			&#x27;info&#x27;: config.log,
			&#x27;debug&#x27;: config.log,
			&#x27;trace&#x27;: config.log
		};
	}

	function assert(expr, msg) {
		if (!expr) {
			throw new Error(msg);
		}
	}
	config.selenium = config.selenium || {
		hostname: &#x27;localhost&#x27;,
		port: 4444
	};
	config.repeat = config.repeat || 1;
	config.name = config.name || config.url;
	config.suite = config.suite || &#x27;Default Test Suite&#x27;;

	if (typeof config.callback !== &#x27;function&#x27;) {
		config.callback = noop;
	}

	if (typeof config.couch === &#x27;undefined&#x27;) {
		config.couch = {};
	}

	if (typeof config.couch.username !== &#x27;undefined&#x27;) {
		var url = require(&#x27;url&#x27;);
		var href = url.parse(config.couch.server);
		href.auth = config.couch.username + &#x27;:&#x27; + config.couch.pwd;
		config.couch.server = url.format(href);
	}
	assert(typeof config.couch.server !== &#x27;undefined&#x27;, &#x27;Location to save results is not defined. Please define a couchDB server&#x27;);

	config.couch.database = config.couch.db || config.couch.database;
	assert(typeof config.couch.server !== &#x27;undefined&#x27;, &#x27;Location to save results is not defined. Please define a Database to save the
 results&#x27;);
	return config;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...



module.exports = function(grunt) {
grunt.registerMultiTask(&#x27;perfjankie&#x27;, &#x27;Run rendering performance test cases&#x27;, function() {
  var done = this.async(),
    path = require(&#x27;path&#x27;),
    options = this.<span class="apidocCodeKeywordSpan">options</span>({
      log: { // Expects the following methods,
        fatal: grunt.fail.fatal.bind(grunt.fail),
        error: grunt.fail.warn.bind(grunt.fail),
        warn: grunt.log.error.bind(grunt.log),
        info: grunt.log.ok.bind(grunt.log),
        debug: grunt.verbose.writeln.bind(grunt.verbose),
        trace: grunt.log.debug.bind(grunt.log)
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.perfjankie.perfTests" id="apidoc.module.perfjankie.perfTests">module perfjankie.perfTests</a></h1>


    <h2>
        <a href="#apidoc.element.perfjankie.perfTests.perfTests" id="apidoc.element.perfjankie.perfTests.perfTests">
        function <span class="apidocSignatureSpan">perfjankie.</span>perfTests
        <span class="apidocSignatureSpan">(config)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">perfTests = function (config) {
	var Q = require(&#x27;q&#x27;),
		dfd = Q.defer();

	if (config.couch.onlyUpdateSite) {
		dfd.resolve();
	} else {
		var browserPerf = config.browserPerf || require(&#x27;browser-perf&#x27;),
			log = config.log;

		log.debug(&#x27;Starting Browser Perf&#x27;);
		browserPerf(config.url, function(err, results) {
			if (err) {
				dfd.reject(err);
			} else {
				log.debug(&#x27;Got Browser Perf results back, now saving the results&#x27;);
				dfd.resolve(results);
			}
		}, {
			browsers: config.browsers,
			selenium: config.selenium,
			debug: config.debug,
			preScript: config.preScript,
			preScriptFile: config.preScriptFile,
			actions: config.actions,
			metrics: config.metrics,
			SAUCE_ACCESSKEY: config.SAUCE_ACCESSKEY || undefined,
			SAUCE_USERNAME: config.SAUCE_USERNAME || undefined,
			BROWSERSTACK_USERNAME: config.BROWSERSTACK_USERNAME || undefined,
			BROWSERSTACK_KEY: config.BROWSERSTACK_KEY || undefined
		});
	}
	return dfd.promise;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.perfjankie.task" id="apidoc.module.perfjankie.task">module perfjankie.task</a></h1>


    <h2>
        <a href="#apidoc.element.perfjankie.task.task" id="apidoc.element.perfjankie.task.task">
        function <span class="apidocSignatureSpan">perfjankie.</span>task
        <span class="apidocSignatureSpan">(grunt)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">task = function (grunt) {
  grunt.registerMultiTask(&#x27;perfjankie&#x27;, &#x27;Run rendering performance test cases&#x27;, function() {
    var done = this.async(),
      path = require(&#x27;path&#x27;),
      options = this.options({
        log: { // Expects the following methods,
          fatal: grunt.fail.fatal.bind(grunt.fail),
          error: grunt.fail.warn.bind(grunt.fail),
          warn: grunt.log.error.bind(grunt.log),
          info: grunt.log.ok.bind(grunt.log),
          debug: grunt.verbose.writeln.bind(grunt.verbose),
          trace: grunt.log.debug.bind(grunt.log)
        },
        time: new Date().getTime()
      }),
      files = options.urls;

    options.time = parseFloat(options.time, 10);
    if (options.sauceTunnel) {
      var SauceTunnel = require(&#x27;sauce-tunnel&#x27;);
      grunt.log.writeln(&#x27;Starting Saucelabs Tunnel&#x27;);
      var tunnel = new SauceTunnel(options.SAUCE_USERNAME, options.SAUCE_ACCESSKEY, options.sauceTunnel, true);
      tunnel.start(function(status) {
        grunt.log.ok(&#x27;Saucelabs Tunnel started - &#x27; + status);
        if (status === false) {
          done(false);
        } else {
          runPerfTest(files, options, function(res) {
            grunt.verbose.writeln(&#x27;All perf tests completed&#x27;);
            tunnel.stop(function() {
              done(res);
            });
          });
        }
      });
    } else {
      runPerfTest(files, options, done);
    }
  });

  var perfjankie = require(&#x27;..&#x27;);

  var runPerfTest = function(files, options, cb) {
    var success = true;
    (function runTest(i) {
      if (i &#x3c; files.length) {
        grunt.log.writeln(&#x27;Testing File &#x27;, files[i]);
        var config = {
          url: files[i],
          name: files[i].replace(/(\S)*\/|\.html$/gi, &#x27;&#x27;),
          callback: function(err, res) {
            if (err) {
              success = false;
              console.log(res);
              grunt.log.warn(err);
            } else {
              grunt.log.ok(&#x27;Saved performance metrics&#x27;);
            }
            runTest(i + 1);
          }
        };
        for (var key in options) {
          config[key] = options[key];
        }
        perfjankie(config);
      } else {
        cb(success);
      }
    }(0));
  }
}</pre></li>
    <li>example usage<pre class="apidocCodePre">n/a</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.perfjankie.toString" id="apidoc.module.perfjankie.toString">module perfjankie.toString</a></h1>


    <h2>
        <a href="#apidoc.element.perfjankie.toString.toString" id="apidoc.element.perfjankie.toString.toString">
        function <span class="apidocSignatureSpan">perfjankie.</span>toString
        <span class="apidocSignatureSpan">()</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">function toString() { [native code] }</pre></li>
    <li>example usage<pre class="apidocCodePre">...

log.debug(&#x27;Starting to upload views&#x27;);
(function uploadView(i) {
    if (i &#x3c; views.length) {
        log.debug(&#x27;Checking View &#x27; + views[i]);
        var view = JSON.parse(JSON.stringify(eval(&#x27;_x_ = &#x27; + fs.readFileSync(views[i], &#x27;utf-8&#x27;)), function (
key, val) {
            if (typeof val === &#x27;function&#x27;) {
                return val.<span class="apidocCodeKeywordSpan">toString</span>();
            }
            return val;
        }));
        db.get(view._id, function (err, res) {
            if (!err) {
                view._rev = res._rev;
            }
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.perfjankie.utility" id="apidoc.module.perfjankie.utility">module perfjankie.utility</a></h1>


    <h2>
        <a href="#apidoc.element.perfjankie.utility.forEachDoc" id="apidoc.element.perfjankie.utility.forEachDoc">
        function <span class="apidocSignatureSpan">perfjankie.utility.</span>forEachDoc
        <span class="apidocSignatureSpan">(oldDb, newDb, callback)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">forEachDoc = function (oldDb, newDb, callback) {
		function processBatch(skip) {
			skip = skip || 0;
			var count = 0;
			return Q.ninvoke(oldDb, &#x27;get&#x27;, &#x27;_all_docs&#x27;, {
				limit: MAX_LIMIT,
				skip: skip,
				include_docs: true
			}).then(function(docs) {
				count = docs[0].rows.length;
				return result = docs[0].rows.map(function(data) {
					return callback(data.doc);
				});
			}).then(function(results) {
				return Q.ninvoke(newDb, &#x27;bulk&#x27;, {
					docs: results.filter(function(val) {
						return val !== null;
					})
				}, {
					new_edits: true
				});
			}).then(function() {
				if (count &#x3e;= MAX_LIMIT) {
					return processBatch(skip + MAX_LIMIT);
				} else {
					return Q();
				}
			});
		}

		return processBatch();
	}</pre></li>
    <li>example usage<pre class="apidocCodePre">...
var Q = require(&#x27;q&#x27;);

var utility = require(&#x27;./utility&#x27;);

module.exports = function(oldDb, newDb, config) {
	var log = config.log;

	return utility.<span class="apidocCodeKeywordSpan">forEachDoc</span>(oldDb, newDb, function(doc) {
		if (doc.type !== &#x27;perfData&#x27;) {
			return null;
		}
		delete doc._id;
		delete doc._rev;
		doc.url = null;
		doc.browser = doc.meta._browserName || null;
...</pre></li>
    </ul>


</div>

<div class="apidocSectionDiv">
<h1><a href="#apidoc.module.perfjankie.utils" id="apidoc.module.perfjankie.utils">module perfjankie.utils</a></h1>


    <h2>
        <a href="#apidoc.element.perfjankie.utils.getCouchDB" id="apidoc.element.perfjankie.utils.getCouchDB">
        function <span class="apidocSignatureSpan">perfjankie.utils.</span>getCouchDB
        <span class="apidocSignatureSpan">(options)</span>
        </a>
    </h2>
    <ul>
    <li>description and source-code<pre class="apidocCodePre">getCouchDB = function (options) {
    var serverUrl = options.server,
        server;
    if (options.requestOptions) {
        server = nano({
            &#x22;url&#x22;: serverUrl,
            &#x22;parseUrl&#x22;: false,
            &#x22;requestDefaults&#x22;: options.requestOptions
        });
    } else {
        server = nano({
            &#x22;url&#x22;: serverUrl,
            &#x22;parseUrl&#x22;: false
        });
    }
    return server;
}</pre></li>
    <li>example usage<pre class="apidocCodePre">...






module.exports = function (config, data) {
var server = require(&#x27;./utils&#x27;).<span class="apidocCodeKeywordSpan">getCouchDB</span>(config.couch),
    Q = require(&#x27;q&#x27;),
    dfd = Q.defer();

var db = null,
    log = config.log;

db = server.use(config.couch.database);
...</pre></li>
    </ul>


</div>

<div class="apidocFooterDiv">
    [ this document was created with
    <a href="https://github.com/kaizhu256/node-utility2" target="_blank">utility2</a>
    ]
</div>
</div>
